<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Love Connection</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: linear-gradient(135deg, #1a0a2e 0%, #2d1b4e 50%, #1a0a2e 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            overflow: hidden;
        }
        h1 {
            color: #ff6b9d;
            text-shadow: 0 0 20px #ff6b9d, 0 0 40px #ff6b9d;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        .subtitle {
            color: #a8d4ff;
            margin-bottom: 20px;
            font-size: 0.9em;
        }
        #gameCanvas {
            border: 3px solid #ff6b9d;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(255, 107, 157, 0.5), inset 0 0 50px rgba(255, 107, 157, 0.1);
        }
        .score-container {
            display: flex;
            gap: 40px;
            margin-top: 15px;
            font-size: 1.1em;
            align-items: center;
        }
        .p1-score { color: #ff6b9d; text-shadow: 0 0 10px #ff6b9d; }
        .p2-score { color: #6bffff; text-shadow: 0 0 10px #6bffff; }
        .love-score { color: #ffd700; text-shadow: 0 0 10px #ffd700; font-size: 1.3em; }
        .love-meter-container {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .love-meter {
            width: 120px;
            height: 16px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid #ff6b9d;
        }
        .love-meter-fill {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ff6b9d, #ffd700, #ff6b9d);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
            transition: width 0.3s;
        }
        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }
        .controls {
            margin-top: 20px;
            display: flex;
            gap: 60px;
            color: #888;
            font-size: 0.85em;
        }
        .controls span { color: #ff6b9d; }
        .controls .p2 span { color: #6bffff; }
        #achievement {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%) translateY(-100px);
            background: linear-gradient(135deg, #ff6b9d, #ffd700);
            color: #1a0a2e;
            padding: 15px 30px;
            border-radius: 30px;
            font-weight: bold;
            font-size: 1.2em;
            transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 100;
        }
        #achievement.show {
            transform: translateX(-50%) translateY(0);
        }
    </style>
</head>
<body>
    <h1>Love Connection</h1>
    <div class="subtitle">Catch hearts, collect love notes, hug to score!</div>
    <canvas id="gameCanvas" width="800" height="500"></canvas>
    <div class="score-container">
        <div class="p1-score">P1: <span id="score1">0</span></div>
        <div class="love-meter-container">
            <span style="color: #ff6b9d;">Love</span>
            <div class="love-meter"><div class="love-meter-fill" id="loveMeter"></div></div>
        </div>
        <div class="love-score">Together: <span id="lovescore">0</span></div>
        <div class="p2-score">P2: <span id="score2">0</span></div>
    </div>
    <div class="controls">
        <div><span>WASD</span> - Player 1 (Pink)</div>
        <div class="p2"><span>Arrows</span> - Player 2 (Cyan)</div>
    </div>
    <div id="achievement"></div>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Players
        const player1 = {
            x: 150, y: 250, size: 30, speed: 5,
            color: '#ff6b9d', glow: 'rgba(255, 107, 157, 0.5)',
            score: 0, hearts: 0, trail: []
        };
        const player2 = {
            x: 650, y: 250, size: 30, speed: 5,
            color: '#6bffff', glow: 'rgba(107, 255, 255, 0.5)',
            score: 0, hearts: 0, trail: []
        };

        let loveScore = 0;
        let loveMeter = 0;
        let hearts = [];
        let particles = [];
        let sparkles = [];
        let fireflies = [];
        let loveNotes = [];
        let floatingTexts = [];
        let fireworks = [];
        let pets = { p1: [], p2: [] };
        let keys = {};
        let lastHugTime = 0;
        let rainbowMode = false;
        let rainbowTimer = 0;
        let hugCount = 0;
        let achievements = [];
        let shownAchievements = new Set();

        const loveMessages = [
            "You're amazing!",
            "Perfect together!",
            "Soulmates!",
            "True love!",
            "Forever yours!",
            "My favorite!",
            "You + Me = Us",
            "Dream team!",
            "Lucky in love!",
            "Heart to heart!"
        ];

        const compliments = [
            "Beautiful!", "Wonderful!", "Adorable!", "Precious!",
            "Sweethearts!", "Cuties!", "Lovebirds!", "Perfect!"
        ];

        // Initialize fireflies
        for (let i = 0; i < 20; i++) {
            fireflies.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: 2 + Math.random() * 3,
                speed: 0.3 + Math.random() * 0.5,
                angle: Math.random() * Math.PI * 2,
                pulse: Math.random() * Math.PI * 2
            });
        }

        // Initialize pets (little stars that follow players)
        for (let i = 0; i < 3; i++) {
            pets.p1.push({ x: player1.x, y: player1.y, delay: i * 5 });
            pets.p2.push({ x: player2.x, y: player2.y, delay: i * 5 });
        }

        // Input handling
        document.addEventListener('keydown', e => {
            keys[e.key.toLowerCase()] = true;
            keys[e.key] = true;
            e.preventDefault();
        });
        document.addEventListener('keyup', e => {
            keys[e.key.toLowerCase()] = false;
            keys[e.key] = false;
        });

        function showAchievement(text) {
            if (shownAchievements.has(text)) return;
            shownAchievements.add(text);
            const el = document.getElementById('achievement');
            el.textContent = text;
            el.classList.add('show');
            setTimeout(() => el.classList.remove('show'), 3000);
        }

        function spawnHeart() {
            if (hearts.length < 8) {
                hearts.push({
                    x: 100 + Math.random() * 600,
                    y: -30,
                    size: 15 + Math.random() * 10,
                    speed: 1 + Math.random() * 2,
                    wobble: Math.random() * Math.PI * 2,
                    color: Math.random() > 0.3 ? '#ff4d7d' : '#ffd700'
                });
            }
        }

        function spawnLoveNote() {
            if (loveNotes.length < 3 && Math.random() > 0.7) {
                loveNotes.push({
                    x: 100 + Math.random() * 600,
                    y: -40,
                    speed: 0.8 + Math.random(),
                    wobble: Math.random() * Math.PI * 2,
                    message: loveMessages[Math.floor(Math.random() * loveMessages.length)],
                    rotation: (Math.random() - 0.5) * 0.5
                });
            }
        }

        function createFirework(x, y) {
            const colors = ['#ff6b9d', '#ffd700', '#6bffff', '#ff4d7d', '#a8d4ff'];
            for (let i = 0; i < 50; i++) {
                const angle = (Math.PI * 2 * i) / 50;
                const speed = 3 + Math.random() * 5;
                fireworks.push({
                    x, y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    life: 1,
                    color: colors[Math.floor(Math.random() * colors.length)],
                    size: 2 + Math.random() * 3,
                    gravity: 0.05
                });
            }
        }

        function addFloatingText(x, y, text, color) {
            floatingTexts.push({
                x, y, text, color,
                life: 1,
                vy: -2
            });
        }

        function drawHeart(x, y, size, color) {
            ctx.save();
            ctx.fillStyle = color;
            ctx.shadowColor = color;
            ctx.shadowBlur = 15;
            ctx.beginPath();
            ctx.moveTo(x, y + size * 0.3);
            ctx.bezierCurveTo(x, y, x - size, y, x - size, y + size * 0.3);
            ctx.bezierCurveTo(x - size, y + size * 0.6, x, y + size, x, y + size * 1.2);
            ctx.bezierCurveTo(x, y + size, x + size, y + size * 0.6, x + size, y + size * 0.3);
            ctx.bezierCurveTo(x + size, y, x, y, x, y + size * 0.3);
            ctx.fill();
            ctx.restore();
        }

        function drawStar(x, y, size, color, rotation = 0) {
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(rotation);
            ctx.fillStyle = color;
            ctx.shadowColor = color;
            ctx.shadowBlur = 10;
            ctx.beginPath();
            for (let i = 0; i < 5; i++) {
                ctx.lineTo(0, -size);
                ctx.rotate(Math.PI / 5);
                ctx.lineTo(0, -size * 0.5);
                ctx.rotate(Math.PI / 5);
            }
            ctx.fill();
            ctx.restore();
        }

        function drawLoveNote(note) {
            ctx.save();
            ctx.translate(note.x, note.y);
            ctx.rotate(note.rotation + Math.sin(note.wobble) * 0.1);

            // Paper
            ctx.fillStyle = '#fff5f8';
            ctx.shadowColor = '#ff6b9d';
            ctx.shadowBlur = 15;
            ctx.fillRect(-40, -25, 80, 50);

            // Fold line
            ctx.strokeStyle = '#ffccd5';
            ctx.beginPath();
            ctx.moveTo(-40, 0);
            ctx.lineTo(40, 0);
            ctx.stroke();

            // Heart seal
            drawHeart(30, -20, 8, '#ff6b9d');

            // Text
            ctx.fillStyle = '#ff6b9d';
            ctx.font = 'bold 11px Georgia';
            ctx.textAlign = 'center';
            ctx.shadowBlur = 0;
            ctx.fillText(note.message, 0, 5);

            ctx.restore();
        }

        function drawPlayer(p, isP1) {
            // Trail
            ctx.save();
            p.trail.forEach((t, i) => {
                const alpha = (i / p.trail.length) * 0.3;
                ctx.fillStyle = rainbowMode
                    ? `hsla(${(Date.now() / 10 + i * 10) % 360}, 100%, 70%, ${alpha})`
                    : (isP1 ? `rgba(255, 107, 157, ${alpha})` : `rgba(107, 255, 255, ${alpha})`);
                ctx.beginPath();
                ctx.arc(t.x, t.y, p.size * 0.5 * (i / p.trail.length), 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.restore();

            ctx.save();
            // Glow
            ctx.shadowColor = rainbowMode
                ? `hsl(${(Date.now() / 10) % 360}, 100%, 70%)`
                : p.color;
            ctx.shadowBlur = 25;

            // Body (heart shape!)
            const bodyColor = rainbowMode
                ? `hsl(${(Date.now() / 10 + (isP1 ? 0 : 180)) % 360}, 100%, 70%)`
                : p.color;
            ctx.fillStyle = bodyColor;
            drawHeart(p.x, p.y - p.size * 0.3, p.size, bodyColor);

            // Eyes
            ctx.shadowBlur = 0;
            ctx.fillStyle = '#fff';
            ctx.beginPath();
            ctx.arc(p.x - 8, p.y + 5, 5, 0, Math.PI * 2);
            ctx.arc(p.x + 8, p.y + 5, 5, 0, Math.PI * 2);
            ctx.fill();

            // Pupils - look at each other!
            const other = isP1 ? player2 : player1;
            const lookX = Math.sign(other.x - p.x) * 2;
            const lookY = Math.sign(other.y - p.y) * 1;
            ctx.fillStyle = '#333';
            ctx.beginPath();
            ctx.arc(p.x - 8 + lookX, p.y + 5 + lookY, 2.5, 0, Math.PI * 2);
            ctx.arc(p.x + 8 + lookX, p.y + 5 + lookY, 2.5, 0, Math.PI * 2);
            ctx.fill();

            // Blush
            ctx.fillStyle = 'rgba(255, 150, 180, 0.5)';
            ctx.beginPath();
            ctx.ellipse(p.x - 15, p.y + 12, 6, 4, 0, 0, Math.PI * 2);
            ctx.ellipse(p.x + 15, p.y + 12, 6, 4, 0, 0, Math.PI * 2);
            ctx.fill();

            // Smile when close to each other
            const playerDist = dist(player1, player2);
            if (playerDist < 150) {
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.beginPath();
                ctx.arc(p.x, p.y + 15, 8, 0.1 * Math.PI, 0.9 * Math.PI);
                ctx.stroke();
            }

            ctx.restore();
        }

        function drawPets() {
            const time = Date.now() / 1000;

            // P1 pets (pink stars)
            pets.p1.forEach((pet, i) => {
                pet.x += (player1.x - 40 + i * 20 - pet.x) * 0.05;
                pet.y += (player1.y - 50 - pet.y) * 0.05;
                const bounce = Math.sin(time * 3 + i) * 5;
                drawStar(pet.x, pet.y + bounce, 6, '#ff6b9d', time + i);
            });

            // P2 pets (cyan stars)
            pets.p2.forEach((pet, i) => {
                pet.x += (player2.x + 40 - i * 20 - pet.x) * 0.05;
                pet.y += (player2.y - 50 - pet.y) * 0.05;
                const bounce = Math.sin(time * 3 + i + Math.PI) * 5;
                drawStar(pet.x, pet.y + bounce, 6, '#6bffff', time + i);
            });
        }

        function createLoveExplosion(x, y) {
            for (let i = 0; i < 30; i++) {
                const angle = (Math.PI * 2 * i) / 30;
                const speed = 2 + Math.random() * 4;
                particles.push({
                    x, y,
                    vx: Math.cos(angle) * speed,
                    vy: Math.sin(angle) * speed,
                    life: 1,
                    color: rainbowMode
                        ? `hsl(${Math.random() * 360}, 100%, 70%)`
                        : (Math.random() > 0.5 ? '#ff6b9d' : '#ffd700'),
                    size: 3 + Math.random() * 5
                });
            }
            for (let i = 0; i < 10; i++) {
                sparkles.push({
                    x: x + (Math.random() - 0.5) * 100,
                    y: y + (Math.random() - 0.5) * 100,
                    life: 1,
                    size: 5 + Math.random() * 10
                });
            }
        }

        function dist(a, b) {
            return Math.sqrt((a.x - b.x) ** 2 + (a.y - b.y) ** 2);
        }

        function update() {
            // Player 1 movement (WASD)
            let p1Moving = false;
            if (keys['w'] && player1.y > 40) { player1.y -= player1.speed; p1Moving = true; }
            if (keys['s'] && player1.y < canvas.height - 40) { player1.y += player1.speed; p1Moving = true; }
            if (keys['a'] && player1.x > 40) { player1.x -= player1.speed; p1Moving = true; }
            if (keys['d'] && player1.x < canvas.width - 40) { player1.x += player1.speed; p1Moving = true; }

            // Player 2 movement (Arrows)
            let p2Moving = false;
            if (keys['ArrowUp'] && player2.y > 40) { player2.y -= player2.speed; p2Moving = true; }
            if (keys['ArrowDown'] && player2.y < canvas.height - 40) { player2.y += player2.speed; p2Moving = true; }
            if (keys['ArrowLeft'] && player2.x > 40) { player2.x -= player2.speed; p2Moving = true; }
            if (keys['ArrowRight'] && player2.x < canvas.width - 40) { player2.x += player2.speed; p2Moving = true; }

            // Trails
            if (p1Moving) {
                player1.trail.push({ x: player1.x, y: player1.y });
                if (player1.trail.length > 15) player1.trail.shift();
            }
            if (p2Moving) {
                player2.trail.push({ x: player2.x, y: player2.y });
                if (player2.trail.length > 15) player2.trail.shift();
            }

            // Rainbow mode timer
            if (rainbowMode) {
                rainbowTimer--;
                if (rainbowTimer <= 0) rainbowMode = false;
            }

            // Fireflies
            fireflies.forEach(f => {
                f.angle += (Math.random() - 0.5) * 0.3;
                f.x += Math.cos(f.angle) * f.speed;
                f.y += Math.sin(f.angle) * f.speed;
                f.pulse += 0.1;
                if (f.x < 0) f.x = canvas.width;
                if (f.x > canvas.width) f.x = 0;
                if (f.y < 0) f.y = canvas.height;
                if (f.y > canvas.height) f.y = 0;
            });

            // Hearts
            hearts.forEach((h, i) => {
                h.y += h.speed;
                h.wobble += 0.05;
                h.x += Math.sin(h.wobble) * 0.5;

                if (dist(player1, h) < player1.size + h.size) {
                    const points = h.color === '#ffd700' ? 3 : 1;
                    player1.score += points;
                    player1.hearts++;
                    hearts.splice(i, 1);
                    createLoveExplosion(h.x, h.y);
                    loveMeter = Math.min(100, loveMeter + 5);
                } else if (dist(player2, h) < player2.size + h.size) {
                    const points = h.color === '#ffd700' ? 3 : 1;
                    player2.score += points;
                    player2.hearts++;
                    hearts.splice(i, 1);
                    createLoveExplosion(h.x, h.y);
                    loveMeter = Math.min(100, loveMeter + 5);
                } else if (h.y > canvas.height + 30) {
                    hearts.splice(i, 1);
                }
            });

            // Love notes
            loveNotes.forEach((note, i) => {
                note.y += note.speed;
                note.wobble += 0.03;
                note.x += Math.sin(note.wobble) * 0.3;

                // Both players need to be close to collect!
                const d1 = dist(player1, note);
                const d2 = dist(player2, note);
                if (d1 < 50 && d2 < 50) {
                    loveScore += 25;
                    loveMeter = Math.min(100, loveMeter + 15);
                    addFloatingText(note.x, note.y, note.message, '#ffd700');
                    createLoveExplosion(note.x, note.y);
                    loveNotes.splice(i, 1);

                    if (!shownAchievements.has('First Love Note!')) {
                        showAchievement('First Love Note!');
                    }
                } else if (note.y > canvas.height + 50) {
                    loveNotes.splice(i, 1);
                }
            });

            // Hug detection
            const playerDist = dist(player1, player2);
            if (playerDist < player1.size + player2.size && Date.now() - lastHugTime > 500) {
                const combinedHearts = player1.hearts + player2.hearts;
                if (combinedHearts > 0) {
                    loveScore += combinedHearts * 5;
                    loveMeter = Math.min(100, loveMeter + combinedHearts * 3);
                    player1.hearts = 0;
                    player2.hearts = 0;
                    hugCount++;

                    const midX = (player1.x + player2.x) / 2;
                    const midY = (player1.y + player2.y) / 2;
                    createLoveExplosion(midX, midY);
                    addFloatingText(midX, midY - 30, compliments[Math.floor(Math.random() * compliments.length)], '#ffd700');

                    // Achievements
                    if (hugCount === 1) showAchievement('First Hug!');
                    if (hugCount === 10) showAchievement('10 Hugs! Adorable!');
                    if (hugCount === 25) showAchievement('25 Hugs! Inseparable!');
                }
                lastHugTime = Date.now();
            }

            // Love meter effects
            if (loveMeter >= 100) {
                if (!rainbowMode) {
                    rainbowMode = true;
                    rainbowTimer = 300;
                    createFirework(200, 150);
                    createFirework(600, 150);
                    createFirework(400, 100);
                    addFloatingText(canvas.width / 2, canvas.height / 2, 'RAINBOW MODE!', '#ffd700');
                    if (!shownAchievements.has('Rainbow Love!')) {
                        showAchievement('Rainbow Love!');
                    }
                }
                loveMeter = 0;
            }

            // Update particles
            particles = particles.filter(p => {
                p.x += p.vx;
                p.y += p.vy;
                p.vy += 0.1;
                p.life -= 0.02;
                return p.life > 0;
            });

            // Update fireworks
            fireworks = fireworks.filter(f => {
                f.x += f.vx;
                f.y += f.vy;
                f.vy += f.gravity;
                f.vx *= 0.99;
                f.life -= 0.015;
                return f.life > 0;
            });

            // Update sparkles
            sparkles = sparkles.filter(s => {
                s.life -= 0.03;
                return s.life > 0;
            });

            // Update floating texts
            floatingTexts = floatingTexts.filter(t => {
                t.y += t.vy;
                t.life -= 0.02;
                return t.life > 0;
            });

            // Achievements based on score
            if (loveScore >= 100 && !shownAchievements.has('100 Love!')) showAchievement('100 Love Points!');
            if (loveScore >= 500 && !shownAchievements.has('500 Love!')) showAchievement('500 Love! Amazing!');
            if (loveScore >= 1000 && !shownAchievements.has('1000 Love!')) showAchievement('1000 Love! Legendary!');

            // Update UI
            document.getElementById('score1').textContent = player1.score;
            document.getElementById('score2').textContent = player2.score;
            document.getElementById('lovescore').textContent = loveScore;
            document.getElementById('loveMeter').style.width = loveMeter + '%';
        }

        function draw() {
            // Background
            const gradient = ctx.createRadialGradient(400, 250, 0, 400, 250, 400);
            if (rainbowMode) {
                const hue = (Date.now() / 50) % 360;
                gradient.addColorStop(0, `hsl(${hue}, 30%, 20%)`);
                gradient.addColorStop(1, `hsl(${(hue + 60) % 360}, 30%, 10%)`);
            } else {
                gradient.addColorStop(0, '#2d1b4e');
                gradient.addColorStop(1, '#1a0a2e');
            }
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // Fireflies
            fireflies.forEach(f => {
                const alpha = 0.3 + Math.sin(f.pulse) * 0.3;
                ctx.fillStyle = `rgba(255, 255, 200, ${alpha})`;
                ctx.shadowColor = '#ffffaa';
                ctx.shadowBlur = 10;
                ctx.beginPath();
                ctx.arc(f.x, f.y, f.size, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.shadowBlur = 0;

            // Connection line between players
            const playerDist = dist(player1, player2);
            if (playerDist < 200) {
                const alpha = (200 - playerDist) / 200;
                ctx.strokeStyle = rainbowMode
                    ? `hsla(${(Date.now() / 10) % 360}, 100%, 70%, ${alpha * 0.5})`
                    : `rgba(255, 215, 107, ${alpha * 0.5})`;
                ctx.lineWidth = 3;
                ctx.setLineDash([10, 10]);
                ctx.beginPath();
                ctx.moveTo(player1.x, player1.y);
                ctx.lineTo(player2.x, player2.y);
                ctx.stroke();
                ctx.setLineDash([]);

                if (playerDist < 100) {
                    const midX = (player1.x + player2.x) / 2;
                    const midY = (player1.y + player2.y) / 2;
                    const heartAlpha = (100 - playerDist) / 100;
                    ctx.globalAlpha = heartAlpha;
                    const pulseSize = 15 + Math.sin(Date.now() / 100) * 3;
                    drawHeart(midX, midY - 20, pulseSize, rainbowMode ? `hsl(${(Date.now() / 10) % 360}, 100%, 70%)` : '#ffd700');
                    ctx.globalAlpha = 1;
                }
            }

            // Hearts held indicator
            if (player1.hearts > 0) {
                ctx.fillStyle = '#ff6b9d';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`x${player1.hearts}`, player1.x + 25, player1.y - 20);
            }
            if (player2.hearts > 0) {
                ctx.fillStyle = '#6bffff';
                ctx.font = 'bold 14px Arial';
                ctx.fillText(`x${player2.hearts}`, player2.x + 25, player2.y - 20);
            }

            // Fireworks
            fireworks.forEach(f => {
                ctx.globalAlpha = f.life;
                ctx.fillStyle = f.color;
                ctx.shadowColor = f.color;
                ctx.shadowBlur = 5;
                ctx.beginPath();
                ctx.arc(f.x, f.y, f.size * f.life, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;
            ctx.shadowBlur = 0;

            // Particles
            particles.forEach(p => {
                ctx.globalAlpha = p.life;
                ctx.fillStyle = p.color;
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size * p.life, 0, Math.PI * 2);
                ctx.fill();
            });
            ctx.globalAlpha = 1;

            // Sparkles
            sparkles.forEach(s => {
                ctx.save();
                ctx.globalAlpha = s.life;
                ctx.fillStyle = '#fff';
                ctx.shadowColor = '#ffd700';
                ctx.shadowBlur = 20;
                ctx.translate(s.x, s.y);
                ctx.rotate(Date.now() / 200);
                ctx.beginPath();
                for (let i = 0; i < 4; i++) {
                    ctx.lineTo(0, -s.size * s.life);
                    ctx.rotate(Math.PI / 4);
                    ctx.lineTo(0, -s.size * s.life * 0.4);
                    ctx.rotate(Math.PI / 4);
                }
                ctx.fill();
                ctx.restore();
            });

            // Love notes
            loveNotes.forEach(note => drawLoveNote(note));

            // Hearts
            hearts.forEach(h => {
                drawHeart(h.x, h.y, h.size, h.color);
            });

            // Pets
            drawPets();

            // Players
            drawPlayer(player1, true);
            drawPlayer(player2, false);

            // Floating texts
            floatingTexts.forEach(t => {
                ctx.globalAlpha = t.life;
                ctx.fillStyle = t.color;
                ctx.font = 'bold 18px Arial';
                ctx.textAlign = 'center';
                ctx.shadowColor = t.color;
                ctx.shadowBlur = 10;
                ctx.fillText(t.text, t.x, t.y);
            });
            ctx.globalAlpha = 1;
            ctx.textAlign = 'left';
            ctx.shadowBlur = 0;

            // Instructions
            if (Date.now() % 4000 < 2000) {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.font = '14px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('Collect hearts & HUG! Catch love notes TOGETHER! Fill the love meter!', canvas.width / 2, 25);
                ctx.textAlign = 'left';
            }

            // Rainbow mode indicator
            if (rainbowMode) {
                ctx.fillStyle = `hsl(${(Date.now() / 10) % 360}, 100%, 70%)`;
                ctx.font = 'bold 16px Arial';
                ctx.textAlign = 'center';
                ctx.fillText('RAINBOW MODE!', canvas.width / 2, canvas.height - 15);
                ctx.textAlign = 'left';
            }
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }

        // Spawn items
        setInterval(spawnHeart, 800);
        setInterval(spawnLoveNote, 3000);

        gameLoop();
    </script>
</body>
</html>
